name: Ejemplo de Workflow con PR Mergeado

on:
  workflow_dispatch:
    inputs:
      branchPr:
        description: 'PR'
        type: string
        required: true
      releaseType:
        description: 'Release type'
        required: true
        default: 'Weekly release name'
        type: choice
        options:
          - Weekly release
          - Emergency
      releaseName:
        description: 'Release name'
        type: string
        required: true
      rootCausePr:
        description: 'Root Cause PR'
        type: string
        required: true
      jiraTicket:
        description: 'Jira ticket'
        type: string
        required: true
      reason4Fix:
        description: 'Reason fix is critical'
        type: string
        required: true
jobs:

  check-pr-information:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - name: Print Variables
        run: |
          echo "PR: $PR"
          echo "TYPE: $TYPE"
          echo "RELEASE_NAME: $RELEASE_NAME"
          echo "ROOT_CAUSE_PR: $ROOT_CAUSE_PR"
          echo "JIRA_TICKET: $JIRA_TICKET"
          echo "REASON_FIX: $REASON_FIX"
        env:
          PR: ${{ inputs.branchPr }}
          TYPE: ${{ inputs.releaseType }}
          RELEASE_NAME: ${{ inputs.releaseName }}
          ROOT_CAUSE_PR: ${{ inputs.rootCausePr }}
          JIRA_TICKET: ${{ inputs.jiraTicket }}
          REASON_FIX: ${{ inputs.reason4Fix }}
      - name: get the Pr information
        run: |
          echo ${{ inputs.branchPr }} PR ID
          pwd
          prJson="$(gh pr view ${{ inputs.branchPr }} --json author,mergeCommit,mergeable,mergedAt,number,title,url,id,labels)" 
          echo 'PR_JSON='$prJson >> $GITHUB_ENV
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      - name: Print PR info
        run: |
          echo "PR_JSON: $PR_JSON"
          echo "REASON_FIX: $REASON_FIX"
      - name: get Release information
        run: |
          releases="$(gh release list --limit 1 --json name,tagName)" 
          echo 'RELEASES='$releases >> $GITHUB_ENV
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
      - name: Print Releases info
        run: |
          echo "$RELEASES" | jq '.[0]'
      - name: Obtener ID de Release
        id: obtener_id_release
        run: |
          release_info=$(gh release list --json tagName,publishedAt)
          release_tag="1"
          release_id=$(echo $release_info | jq -r --arg release_tag "$release_tag" '.[] | select(.tagName == $release_tag and .publishedAt != null) | .publishedAt')
          echo 'RELEASEID='$release_id >> $GITHUB_ENV
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          
        
